<input type="hidden" name="_token" value="<?php echo e(csrf_token()); ?>" id="token">
<input type="hidden" name="cadenaEstados" value="<?php echo $datosPreferencias["cadenaestados"]; ?>" id="cadenaEstados">
<input type="hidden" name="cadenaPaises" value="" id="cadenaPaises">
<br>
      <font style="color: #b9261e"><h3 class="title"><?php echo e(trans("leng.Destinos/Orígenes Favoritos")); ?></h3></font>
      <br>
      <div class="col-md-12" style="font-size: 0.9em">
          <div class="row">
              <b><?php echo e(trans("leng.Seleccione los paises y departamentos favoritos, para guardar cambios ingrese a la pestaña Departamentos")); ?>.</b>
          </div>
          <br>
          <?php
            $tabPaisActivo="";
            $tabEstadoActivo="";
            $divPaisActivo="";
            $divEstadoActivo="";
            if($datosPreferencias["cadenaestados"]==""){
                $tabPaisActivo="active";
                $tabEstadoActivo="";
                $divPaisActivo="active in";
                $divEstadoActivo="";
            }else{
                $tabPaisActivo="";
                $tabEstadoActivo="active";
                $divPaisActivo="";
                $divEstadoActivo="active in";
            }
          ?>
          
          <div class="row">
             <ul id="myTab1" class="nav nav-tabs">
                 <li id="tabtabPais" class="<?php echo $tabPaisActivo; ?>" >
                      <a href="#tabPais" id="tPais"  data-toggle="tab"><?php echo e(trans("leng.Paises")); ?></a>
                    </li>
                <li  class="<?php echo $tabEstadoActivo; ?>">
                        <a href="#tabEstado" id="tEstado" data-toggle="tab"><?php echo e(trans("leng.Departamentos")); ?></a>
                    </li>
             </ul>
              <div id="myTab2Content" class="tab-content">
                  
                <div class="tab-pane fade <?php echo $divPaisActivo; ?> " id="tabPais">
                   <?php echo $datosPreferencias["paises"]; ?>
                    <br><br>
                    <div class="row">
                            <div class="col-sm-6">
                                <button type="button" class="btn btn-danger" onclick="$('#elementosPerfil').html('');$('#back-to-top').click();"><i class="fa fa-times-circle"></i>&nbsp;<?php echo e(trans("leng.Cancelar")); ?></button>
                                
                            </div>
                    </div>
                </div>

                <div class="tab-pane fade <?php echo $divEstadoActivo; ?> " id="tabEstado">
                    <?php echo $datosPreferencias["estados"]; ?>
                    <br><br>
                    <div class="row">
                            <div class="col-sm-10">
                                <button type="button" class="btn btn-success" onclick="guardarPreferenciasTransportista()"><i class="fa fa-check-circle"></i>&nbsp;<?php echo e(trans("leng.Guardar cambios")); ?></button>
                                <button type="button" class="btn btn-danger" onclick="$('#elementosPerfil').html('');$('#back-to-top').click();"><i class="fa fa-times-circle"></i>&nbsp;<?php echo e(trans("leng.Cancelar")); ?></button>
                            </div>
                    </div>
                </div>
                    
                </div>
              
          </div>
          
            <br><br>
            <div class="row" style="display: none" id="botonesGuardar">
                    <div class="col-sm-10">

                        <button type="button" class="btn btn-success" onclick="guardarPreferenciasTransportista()"><i class="fa fa-check-circle"></i>&nbsp;<?php echo e(trans("leng.Guardar cambios")); ?></button>
                        <button type="button" class="btn btn-secondary" onclick="$('#elementosPerfil').html('');$('#back-to-top').click();"><i class="fa fa-times-circle"></i>&nbsp;<?php echo e(trans("leng.Cancelar")); ?></button>
                    </div>
            </div>
  </div>            
<script>
    
    $('#tEstado').on('shown.bs.tab', function (e) {
        var cadenap="";
        var cp=0;
          var chPais = document.getElementsByName("chPais");
            var i;
            for (i = 0; i < chPais.length; i++) {
                if(chPais[i].checked==true){
                   cadenap=cadenap+chPais[i].id+',';
                   cp=1;
                }
            }
            if(cp==0){
                $("#tPais").click();
                swal("","Seleccione por lo menos un país.","warning");
            }else{
                $("#cadenaPaises").val(cadenap);
                $("#botonesGuardar").removeAttr("style");
                cargarEstadosTab();
            }
                
    });


/*
    * Carga los estados de los paises seleccionados
    * Autor: OT
    * Fecha: 15-07-2016
    * 
    */
   function cargarEstadosTab(){
       var token=$("#token").val();
       var cadenaPaises=$("#cadenaPaises").val();
       var cadenaEstados=$("#cadenaEstados").val();
       
       
       waitingDialog();
       $.ajax({
            type:"POST",
            headers:{'X-CSRF-TOKEN':token},
            data:{'cadenaPaises':cadenaPaises,'cadenaEstados':cadenaEstados},
            url:"/miPerfil/cargarEstadosTab",
            success:function(respuesta){
                setTimeout(function(){closeWaitingDialog();},100);
                if(respuesta=="error"){
                    swal("","Ocurrio un error al obtener los departamentos.","error");
                }else{
                    $("#tabEstado").html(respuesta)
                }
                
            }
       });
   }
  

    /*
    * Seleccionar todos los estado del pais recibido
    * Autor: OT
    * Fecha: 15-07-2016
    * 
    */
   function seleccionarTodo(idPais){
       var chEstado = document.getElementsByName("chEstado");
       var paisSeleccionado=document.getElementById(idPais);
            var i;
            for (i = 0; i < chEstado.length; i++) {
                if(chEstado[i].value==paisSeleccionado.value){
                   
                   chEstado[i].checked=paisSeleccionado.checked;
                }
            }
   }
   
   /*
    * Al entrar en el tab paises se guardan los estados seleccionados
    * Autor: OT
    * Fecha: 15-07-2016
    * 
    */
   $('#tPais').on('shown.bs.tab', function (e) {
        var cadenae="";
          var chEstado = document.getElementsByName("chEstado");
            var i;
            for (i = 0; i < chEstado.length; i++) {
                if(chEstado[i].checked==true){
                   cadenae=cadenae+chEstado[i].id+',';
                }
            }
            $("#botonesGuardar").attr("style","display:none");
            $("#cadenaEstados").val(cadenae);
            
                
    });


</script>